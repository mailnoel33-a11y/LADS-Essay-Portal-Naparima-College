<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>LADS Essay Portal</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  .hidden { display: none; }
  textarea { min-height: 150px; font-family: monospace; }
  article { margin-top: 2rem; }
  button.delete-btn { margin-left:10px; color:red; }
  button.edit-btn { margin-left:10px; color:blue; }
  nav.tabs ul { display: flex; gap: 1rem; }
  nav.tabs ul li { list-style: none; }
  .essay-text { white-space: pre-wrap; } /* preserves line breaks & tabs */
</style>
</head>
<body>

<main class="container">

  <!-- LOGIN -->
  <section id="login">
    <h2>Club Access</h2>
    <p>Enter the club password to continue.</p>
    <input type="password" id="passwordInput" placeholder="Password">
    <button onclick="checkPassword()">Enter</button>
    <p id="error" style="color:red;"></p>
  </section>

  <!-- CONTENT -->
  <div id="content" class="hidden">

    <!-- TABS -->
    <nav class="tabs">
      <ul>
        <li><a href="#" onclick="showSection('submitSection')">Submit Essay</a></li>
        <li><a href="#" onclick="showSection('viewSection')">View Essays</a></li>
      </ul>
    </nav>

    <!-- SUBMIT ESSAY -->
    <section id="submitSection">
      <h2>Submit an Essay</h2>
      <input type="text" id="author" placeholder="Your Name and Class" required>

      <label>Select up to 3 genres (Hold Ctrl to select multiple)</label>
      <select id="genres" multiple>
        <option>Comedy</option>
        <option>Adventure</option>
        <option>Romance</option>
        <option>Life</option>
        <option>Horror</option>
        <option>Report</option>
        <option>Argumentative</option>
        <option>Persuasive</option>
        <option>Descriptive Works</option>
        <option>Formal Essay</option>
        <option>Complaint</option>
        <option>Letters</option>
      </select>

      <textarea id="essayText" placeholder="Write your essay here..." required></textarea>
      <button onclick="addEssay()">Submit Essay</button>
    </section>

    <!-- VIEW ESSAYS -->
    <section id="viewSection" class="hidden">
      <h2>Search Essays</h2>
      <input type="search" id="search" placeholder="Search by Name, Class, or Genre" oninput="loadEssays()">

      <h2>Submitted Essays</h2>
      <div id="essayList"></div>
    </section>

  </div>

</main>

<footer class="container">
  <small>
    NAPARIMA COLLEGE • LADS • Built for Essay Writing & Essay Appreciation
  </small>
</footer>

<script>
  // === PASSWORDS ===
  const CLUB_PASSWORD = "iwonderwhomadethis?";
  const DELETE_PASSWORD = "supersecretdelete";
  const EDIT_PASSWORD = "supersecretdit";

  // === LOGIN ===
  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    if (input === CLUB_PASSWORD) {
      document.getElementById("login").classList.add("hidden");
      document.getElementById("content").classList.remove("hidden");
      showSection('submitSection'); // default tab
      loadEssays();
    } else {
      document.getElementById("error").textContent = "Incorrect password.";
    }
  }

  // === TAB SWITCHING ===
  function showSection(id) {
    document.getElementById('submitSection').classList.add('hidden');
    document.getElementById('viewSection').classList.add('hidden');
    document.getElementById(id).classList.remove('hidden');
  }

  // === ADD ESSAY ===
  function addEssay() {
    const author = document.getElementById("author").value.trim();
    const text = document.getElementById("essayText").value.trim();
    const genres = Array.from(document.getElementById("genres").selectedOptions).map(o => o.value);

    if (!author || !text || genres.length === 0 || genres.length > 3) {
      alert("Fill all fields and select up to 3 genres.");
      return;
    }

    const essays = JSON.parse(localStorage.getItem("essays")) || [];
    essays.push({ author, text, genres, reactions: [] });
    localStorage.setItem("essays", JSON.stringify(essays));

    document.getElementById("author").value = "";
    document.getElementById("essayText").value = "";
    document.getElementById("genres").selectedIndex = -1;

    alert("Essay submitted successfully!");
  }

  // === LOAD ESSAYS ===
  function loadEssays() {
    const list = document.getElementById("essayList");
    list.innerHTML = "";

    const search = document.getElementById("search").value.toLowerCase();
    const essays = JSON.parse(localStorage.getItem("essays")) || [];

    essays.filter(e => e.author.toLowerCase().includes(search) || e.genres.join(" ").toLowerCase().includes(search))
      .forEach((essay, index) => {
        const article = document.createElement("article");
        article.innerHTML = `
          <h3>${essay.author}</h3>
          <p><strong>Genres:</strong> ${essay.genres.join(", ")}</p>
          <p class="essay-text">${essay.text}</p>

          <h4>Reactions</h4>
          <ul>
            ${essay.reactions.map(r => `<li><strong>${r.name}</strong> (${r.class}) — ${"⭐".repeat(r.rating)}<br>${r.comment}</li>`).join('')}
          </ul>

          <input id="rname-${index}" placeholder="Your name">
          <input id="rclass-${index}" placeholder="Your class">
          <textarea id="rcomment-${index}" placeholder="Your criticism"></textarea>

          <select id="rrating-${index}">
            <option value="1">1 ⭐</option>
            <option value="2">2 ⭐⭐</option>
            <option value="3">3 ⭐⭐⭐</option>
            <option value="4">4 ⭐⭐⭐⭐</option>
            <option value="5">5 ⭐⭐⭐⭐⭐</option>
          </select>

          <button onclick="addReaction(${index})">React</button>
          <button class="edit-btn" onclick="editEssay(${index})">Edit Essay</button>
          <button class="delete-btn" onclick="deleteEssay(${index})">Delete Essay</button>
        `;
        list.appendChild(article);
      });
  }

  // === ADD REACTION ===
  function addReaction(index) {
    const essays = JSON.parse(localStorage.getItem("essays"));
    const name = document.getElementById(`rname-${index}`).value.trim();
    const studentClass = document.getElementById(`rclass-${index}`).value.trim();
    const comment = document.getElementById(`rcomment-${index}`).value.trim();
    const rating = parseInt(document.getElementById(`rrating-${index}`).value);

    if (!name || !studentClass || !comment) {
      alert("Fill all reaction fields.");
      return;
    }

    essays[index].reactions.push({ name, class: studentClass, comment, rating });
    localStorage.setItem("essays", JSON.stringify(essays));
    loadEssays();
  }

  // === DELETE ESSAY ===
  function deleteEssay(index) {
    const input = prompt("Enter delete password:");
    if (input === DELETE_PASSWORD) {
      const essays = JSON.parse(localStorage.getItem("essays")) || [];
      essays.splice(index, 1);
      localStorage.setItem("essays", JSON.stringify(essays));
      loadEssays();
      alert("Essay deleted successfully.");
    } else {
      alert("Incorrect delete password.");
    }
  }

  // === EDIT ESSAY ===
  function editEssay(index) {
    const input = prompt("Enter edit password:");
    if (input === EDIT_PASSWORD) {
      const essays = JSON.parse(localStorage.getItem("essays"));

      const author = prompt("Edit Author/Name:", essays[index].author);
      const text = prompt("Edit Essay Text:", essays[index].text);
      const genres = prompt(
        "Edit Genres (comma-separated, max 3):",
        essays[index].genres.join(", ")
      );

      if (!author || !text || !genres) {
        alert("All fields are required.");
        return;
      }

      const genreArray = genres.split(",").map(g => g.trim()).slice(0,3);

      essays[index] = {
        ...essays[index],
        author: author,
        text: text,
        genres: genreArray
      };

      localStorage.setItem("essays", JSON.stringify(essays));
      loadEssays();
      alert("Essay updated successfully!");
    } else {
      alert("Incorrect edit password.");
    }
  }

  // === ALLOW TAB INDENTATION IN TEXTAREA ===
  const essayTextArea = document.getElementById("essayText");
  essayTextArea.addEventListener("keydown", function(e) {
    if (e.key === "Tab") {
      e.preventDefault();
      const start = this.selectionStart;
      const end = this.selectionEnd;
      this.value = this.value.substring(0, start) + "\t" + this.value.substring(end);
      this.selectionStart = this.selectionEnd = start + 1;
    }
  });
</script>

</body>
</html>
